(function(i){function o(b,d){var f=i('<div class="'+d.binderClass+'"></div>'),c=i('<div class="'+d.contentClass+'"></div>');f.css({position:"absolute",overflow:"hidden"});b.css({position:"relative",overflow:"hidden"});c.css({position:"absolute"});if(d.width!=false&&d.height!=false){c.height(d.height);c.width(d.width)}else if(d.content!=false){c.height(d.content.height());c.width(d.content.width())}d.content!=false?c.append(d.content.detach()):c.append(b.contents().detach());f.append(c);b.append(f);
var g={left:c.offset().left,top:c.offset().top},h={height:c.height(),width:c.width()},k=true,l=true,m=0,n=0;b.bind("dragstop",function(a,e){if(g.top!=e.position.top)k=false;if(g.left!=e.position.left)l=false;g.left=e.position.left;g.top=e.position.top});return{adjust:function(){var a={height:b.height(),width:b.width()},e;if(a.height>h.height){c.css("top",0);f.height(h.height);f.css("top",Math.floor(a.height/2)-Math.floor(h.height/2))}else{e=h.height-a.height;f.height(a.height+e*2);f.css("top",-e);
if(l){g.top=Math.floor(e/2);c.css("top",g.top)}else{var j=g.top+(e-m);j=j>=0?j:0;c.css("top",j);g.top=j}m=e}if(a.width>h.width){c.css("left",0);f.width(h.width);f.css("left",Math.floor(a.width/2)-Math.floor(h.width/2))}else{e=h.width-a.width;f.width(a.width+e*2);f.css("left",-e);if(k){g.left=Math.floor(e/2);c.css("left",g.left)}else{a=g.left+(e-n);a=a>=0?a:0;c.css("left",a);g.left=a}n=e}},setContentHeight:function(a){if(a!=null){h.height=a;c.height(a)}},setContentWidth:function(a){if(a!=null){h.width=
a;c.width(a)}},getContentSize:function(){return h},content:c,binder:f}}i.widget("ui.viewport",{options:{binderClass:"viewportBinder",contentClass:"viewportContent",content:false,height:false,width:false},_create:function(){var b=this.options.content,d=typeof b=="object";if(d&&b.tagName!=null)this.options.content=i(b);else if(d&&i.isArray(b))this.options.content=i(b);this.viewport=o(this.element,this.options);this.viewport.adjust()},content:function(){return this.viewport.content},binder:function(){return this.viewport.binder},
update:function(){this.viewport.adjust()},size:function(b,d){if(b==null||d==null)return this.viewport.getContentSize();this.viewport.setContentHeight(b);this.viewport.setContentWidth(d)},height:function(b){if(b==null)return this.viewport.getContentSize().height;this.viewport.setContentHeight(b)},width:function(b){if(b==null)return this.viewport.getContentSize().width;this.viewport.setContentWidth(b)}})})(jQuery);